<launch>

  <arg name="model"         default="$(optenv TURTLEBOT3_MODEL burger)" doc="model type [burger, waffle, waffle_pi]"/>
  <arg name="gazebo_gui"    default="false"/>
  <arg name="rviz"          default="true"/>
  <arg name="custom_main"   default="true"/>
  <arg name="debug"         default="false"/> <!-- if true: runs gazebo_custom_main.cpp in gdb -->
  <arg name="verbose"       default="false"/>
  <arg name="paused"        default="false"/>

  <arg name="patrol_radius" default="55.0"/>
  <param name="patrol_radius" value="$(arg patrol_radius)"/>

  <!-- load shared experiment config file -->
  <rosparam command="load" file="$(find example)/cfg/example.yaml"/>

  <!-- launch gazebo without custom main -->
  <include unless="$(arg custom_main)"
           file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="world_name"   value="$(find example)/worlds/spawc.world"/>
    <arg name="paused"       value="$(arg paused)"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="headless"     value="false"/>
    <arg name="gui"          value="$(arg gazebo_gui)"/>
    <arg name="debug"        value="$(arg debug)"/>
    <arg name="verbose"      value="$(arg verbose)"/>
  </include>

  <!-- launch gazebo with custom main -->
  <include if="$(arg custom_main)"
           file="$(find physics_coordinator)/launch/custom_main_empty_world.launch">
    <arg name="world_name"   value="$(find example)/worlds/spawc.world"/>
    <arg name="paused"       value="$(arg paused)"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="headless"     value="false"/>
    <arg name="gui"          value="$(arg gazebo_gui)"/>
    <arg name="debug"        value="$(arg debug)"/>
    <arg name="verbose"      value="$(arg verbose)"/>
  </include>

  <node if="$(arg rviz)"
        pkg="rviz"
        type="rviz"
        name="rviz"
        args="-d $(find example)/rviz/example.rviz"
        output="screen"/>

  <!-- load saved octomap -->
  <node pkg="octomap_server"
        type="octomap_server_node"
        name="static_map_node"
        args="$(find example)/maps/spawc_no_ground.bt"
        output="screen">
    <remap from="projected_map" to="/projected_map"/>
    <param name="frame_id" value="world"/>
  </node>

  <!-- pathloss segment node -->
  <node pkg="channel_simulator"
        type="segment_node"
        name="pathloss_segment_node"
        output="screen">
    <remap from="octomap" to="/octomap_binary"/>
  </node>

  <!-- turtlebot 1 -->
  <include file="$(find example)/launch/turtlebot3.launch">
    <arg name="model" value="$(arg model)"/>
    <arg name="name"  value="tb1"/>
    <arg name="x_pos" value="$(eval arg('patrol_radius'))"/>
    <arg name="yaw"   value="1.57"/>
    <!--<arg name="yaw"   value="0.0"/>-->
  </include>

  <!-- turtlebot 2 -->
  <include file="$(find example)/launch/turtlebot3.launch">
    <arg name="model" value="$(arg model)"/>
    <arg name="name"  value="tb2"/>
    <arg name="x_pos" value="$(eval -arg('patrol_radius'))"/>
    <arg name="yaw"   value="-1.57"/>
    <!--<arg name="yaw"   value="1.57"/>-->
  </include>

</launch>
